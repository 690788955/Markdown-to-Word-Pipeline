<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>运维文档生成系统</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>运维文档生成系统</h1>
        </header>

        <main>
            <!-- 配置区域 -->
            <section class="config-bar">
                <div class="config-item">
                    <label>客户配置</label>
                    <div class="client-select-row">
                        <select id="clientSelect">
                            <option value="">加载中...</option>
                        </select>
                        <button id="lockBtn" class="btn btn-icon" style="display:none;" onclick="toggleClientLock()" title="锁定/解锁配置">
                            <span id="lockIcon">🔓</span>
                        </button>
                    </div>
                </div>
                <div class="config-item">
                    <label>客户名称</label>
                    <input type="text" id="clientNameInput" placeholder="可选，覆盖默认名称">
                </div>
                <div class="config-item">
                    <label>输出格式</label>
                    <select id="formatSelect">
                        <option value="word" selected>Word (.docx)</option>
                        <option value="pdf">PDF (.pdf)</option>
                    </select>
                </div>
                <button id="generateAllBtn" class="btn btn-primary" disabled>
                    <span class="btn-text">全部生成</span>
                    <span class="btn-loading" style="display:none;">生成中...</span>
                </button>
                <button id="newConfigBtn" class="btn btn-secondary" onclick="showConfigModal()">
                    <span class="btn-text">+ 新建配置</span>
                </button>
            </section>

            <!-- 文档列表 -->
            <section class="doc-list">
                <div class="list-header">
                    <span>文档类型</span>
                    <span>操作</span>
                </div>
                <div id="docList" class="list-body">
                    <div class="list-empty">请先选择客户配置</div>
                </div>
            </section>

            <!-- 生成结果 -->
            <section id="resultSection" class="result-section" style="display:none;">
                <div class="result-header">
                    <span>📦 已生成文档</span>
                    <button id="downloadAllBtn" class="btn btn-success btn-sm">打包下载</button>
                </div>
                <div id="resultList" class="result-list"></div>
            </section>
        </main>

        <footer>
            <p>运维文档生成系统</p>
        </footer>
    </div>

    <!-- 新建/编辑配置模态框 -->
    <div id="configModal" class="modal">
        <div class="modal-content modal-lg">
            <div class="modal-header">
                <h2 id="modalTitle">新建配置</h2>
                <button class="modal-close" onclick="hideConfigModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="configForm">
                    <!-- 基本信息 -->
                    <div class="form-row">
                        <div class="form-group">
                            <label for="cfgClientName">客户名称 *</label>
                            <input type="text" id="cfgClientName" placeholder="例如：XX公司" required>
                        </div>
                        <div class="form-group">
                            <label for="cfgDocTypeName">文档类型名称 *</label>
                            <input type="text" id="cfgDocTypeName" placeholder="例如：运维手册" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="cfgOutputPattern">输出文件名模式</label>
                            <input type="text" id="cfgOutputPattern" placeholder="{client}_{title}_{date}">
                            <small class="form-hint">支持: {client}, {title}, {version}, {date}（扩展名自动添加）</small>
                        </div>
                    </div>

                    <!-- Tab 导航 -->
                    <div class="config-tabs">
                        <button type="button" class="tab-btn active" data-tab="tabModules">文档模块</button>
                        <button type="button" class="tab-btn" data-tab="tabMetadata">元数据</button>
                        <button type="button" class="tab-btn" data-tab="tabGeneral">通用设置</button>
                        <button type="button" class="tab-btn" data-tab="tabWord">Word 设置</button>
                        <button type="button" class="tab-btn" data-tab="tabPdf">PDF 设置</button>
                    </div>

                    <!-- Tab 内容：文档模块（穿梭框） -->
                    <div id="tabModules" class="tab-content active">
                        <!-- 变量表单 -->
                        <div id="variableForm" class="variable-form-section" style="display:none;"></div>
                        
                        <div class="transfer-container">
                            <!-- 左列：可选模块 -->
                            <div class="transfer-panel transfer-left">
                                <div class="transfer-header">
                                    <span>可选模块</span>
                                    <div class="transfer-actions">
                                        <input type="text" id="moduleSearch" class="module-search" placeholder="搜索模块...">
                                        <button type="button" class="btn btn-sm btn-outline" onclick="selectAllModules()">全选</button>
                                    </div>
                                </div>
                                <div id="availableModules" class="transfer-list">
                                    <div class="list-empty">加载中...</div>
                                </div>
                            </div>
                            <!-- 中间：操作按钮 -->
                            <div class="transfer-buttons">
                                <button type="button" class="btn btn-sm" onclick="moveSelectedToRight()" title="添加选中">→</button>
                                <button type="button" class="btn btn-sm" onclick="moveSelectedToLeft()" title="移除选中">←</button>
                            </div>
                            <!-- 右列：已选模块 -->
                            <div class="transfer-panel transfer-right">
                                <div class="transfer-header">
                                    <span>已选模块 (<span id="selectedCount">0</span>)</span>
                                    <div class="transfer-actions">
                                        <button type="button" class="btn btn-sm btn-outline" onclick="clearAllModules()">清空</button>
                                    </div>
                                </div>
                                <div id="selectedModules" class="transfer-list">
                                    <div class="list-empty">请从左侧选择模块</div>
                                </div>
                            </div>
                        </div>
                        <small class="form-hint" style="margin-top: 8px; display: block;">提示：右侧列表支持拖拽排序，调整文档章节顺序</small>
                    </div>

                    <!-- Tab 内容：元数据 -->
                    <div id="tabMetadata" class="tab-content">
                        <p class="info-text">设置文档的元数据信息，这些值会覆盖默认的 src/metadata.yaml 配置。</p>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="metaTitle">文档标题</label>
                                <input type="text" id="metaTitle" placeholder="例如：XX系统运维手册">
                            </div>
                            <div class="form-group">
                                <label for="metaSubtitle">副标题</label>
                                <input type="text" id="metaSubtitle" placeholder="例如：标准化运维知识库">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="metaAuthor">作者</label>
                                <input type="text" id="metaAuthor" placeholder="例如：运维团队">
                            </div>
                            <div class="form-group">
                                <label for="metaVersion">版本号</label>
                                <input type="text" id="metaVersion" placeholder="例如：v1.0">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="metaDate">日期</label>
                                <input type="text" id="metaDate" placeholder="例如：2026年1月">
                            </div>
                            <div class="form-group">
                                <label for="metaTocTitle">目录标题</label>
                                <input type="text" id="metaTocTitle" placeholder="默认：目录">
                            </div>
                        </div>
                        <div class="form-group">
                            <label>客户信息</label>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="metaClientName">客户名称 <small>(用于文档内容)</small></label>
                                <input type="text" id="metaClientName" placeholder="例如：XX公司">
                            </div>
                            <div class="form-group">
                                <label for="metaClientContact">联系人</label>
                                <input type="text" id="metaClientContact" placeholder="例如：运维工程师">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="metaClientSystem">系统名称</label>
                            <input type="text" id="metaClientSystem" placeholder="例如：XX业务系统">
                        </div>
                        <small class="form-hint">留空的字段将使用默认值（src/metadata.yaml）</small>
                    </div>

                    <!-- Tab 内容：通用设置 -->
                    <div id="tabGeneral" class="tab-content">
                        <div class="pandoc-args-section">
                            <div class="args-category">
                                <h4>基础设置</h4>
                                <div class="checkbox-group">
                                    <label class="checkbox-label">
                                        <input type="checkbox" id="argToc" checked> --toc (生成目录)
                                    </label>
                                    <label class="checkbox-label">
                                        <input type="checkbox" id="argNumberSections" checked> --number-sections (章节编号)
                                    </label>
                                    <label class="checkbox-label">
                                        <input type="checkbox" id="argStandalone" checked> --standalone (独立文档)
                                    </label>
                                    <label class="checkbox-label">
                                        <input type="checkbox" id="argFileScope"> --file-scope (文件独立处理)
                                    </label>
                                    <label class="checkbox-label">
                                        <input type="checkbox" id="argPreserveTabs"> --preserve-tabs (保留Tab)
                                    </label>
                                    <label class="checkbox-label">
                                        <input type="checkbox" id="argStripComments"> --strip-comments (移除注释)
                                    </label>
                                </div>
                            </div>
                            <div class="args-category">
                                <h4>目录设置</h4>
                                <div class="args-row">
                                    <label for="argTocDepth">目录深度</label>
                                    <select id="argTocDepth">
                                        <option value="">默认(3)</option>
                                        <option value="1">1级</option>
                                        <option value="2">2级</option>
                                        <option value="3">3级</option>
                                        <option value="4">4级</option>
                                        <option value="5">5级</option>
                                        <option value="6">6级</option>
                                    </select>
                                </div>
                            </div>
                            <div class="args-category">
                                <h4>标题设置</h4>
                                <div class="args-row">
                                    <label for="argShiftHeading">标题级别偏移</label>
                                    <select id="argShiftHeading">
                                        <option value="">不偏移</option>
                                        <option value="-2">-2 (提升2级)</option>
                                        <option value="-1">-1 (提升1级)</option>
                                        <option value="1">+1 (降低1级)</option>
                                        <option value="2">+2 (降低2级)</option>
                                    </select>
                                </div>
                                <div class="args-row">
                                    <label for="argTopLevelDiv">顶级分区类型</label>
                                    <select id="argTopLevelDiv">
                                        <option value="">默认</option>
                                        <option value="section">section</option>
                                        <option value="chapter">chapter</option>
                                        <option value="part">part</option>
                                    </select>
                                </div>
                            </div>
                            <div class="args-category">
                                <h4>代码高亮</h4>
                                <div class="args-row">
                                    <label for="argHighlightStyle">高亮样式</label>
                                    <select id="argHighlightStyle">
                                        <option value="">默认(pygments)</option>
                                        <option value="pygments">pygments</option>
                                        <option value="kate">kate</option>
                                        <option value="monochrome">monochrome</option>
                                        <option value="espresso">espresso</option>
                                        <option value="zenburn">zenburn</option>
                                        <option value="haddock">haddock</option>
                                        <option value="tango">tango</option>
                                        <option value="breezedark">breezedark</option>
                                    </select>
                                </div>
                                <label class="checkbox-label" style="margin-top:8px;">
                                    <input type="checkbox" id="argNoHighlight"> --no-highlight (禁用代码高亮)
                                </label>
                            </div>
                            <div class="args-category">
                                <h4>文本格式</h4>
                                <div class="args-row">
                                    <label for="argWrap">文本换行</label>
                                    <select id="argWrap">
                                        <option value="">默认(auto)</option>
                                        <option value="auto">auto</option>
                                        <option value="none">none (不换行)</option>
                                        <option value="preserve">preserve (保留原样)</option>
                                    </select>
                                </div>
                                <div class="args-row">
                                    <label for="argColumns">换行列数</label>
                                    <input type="number" id="argColumns" placeholder="默认72" min="20" max="200">
                                </div>
                                <div class="args-row">
                                    <label for="argTabStop">Tab宽度</label>
                                    <select id="argTabStop">
                                        <option value="">默认(4)</option>
                                        <option value="2">2</option>
                                        <option value="4">4</option>
                                        <option value="8">8</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="form-group" style="margin-top: 12px;">
                            <label for="cfgCustomArgs">其他自定义参数</label>
                            <input type="text" id="cfgCustomArgs" placeholder="例如: --metadata=key:value">
                            <small class="form-hint">用空格分隔多个参数</small>
                        </div>
                    </div>

                    <!-- Tab 内容：Word 设置 -->
                    <div id="tabWord" class="tab-content">
                        <div class="format-settings">
                            <div class="args-category">
                                <h4>Word 模板</h4>
                                <div class="form-group">
                                    <label for="cfgTemplate">选择模板</label>
                                    <select id="cfgTemplate">
                                        <option value="">使用默认模板</option>
                                    </select>
                                    <small class="form-hint">Word 字体样式由模板文件控制，修改 templates/default.docx 中的样式</small>
                                </div>
                            </div>
                            <div class="args-category">
                                <h4>说明</h4>
                                <p class="info-text">Word 文档的字体、样式、页眉页脚等由模板文件 (.docx) 控制。</p>
                                <p class="info-text">如需自定义样式：</p>
                                <ol class="info-list">
                                    <li>打开 templates/default.docx</li>
                                    <li>修改"样式"中的字体、大小、颜色等</li>
                                    <li>保存模板文件</li>
                                </ol>
                            </div>
                        </div>
                    </div>

                    <!-- Tab 内容：PDF 设置 -->
                    <div id="tabPdf" class="tab-content">
                        <div class="format-settings">
                            <div class="pdf-settings-grid">
                                <!-- 字体设置 -->
                                <div class="args-category">
                                    <h4>字体设置</h4>
                                    <div class="args-row">
                                        <label for="pdfMainFont">正文字体</label>
                                        <select id="pdfMainFont">
                                            <option value="" selected>默认 (自动选择)</option>
                                            <option value="Microsoft YaHei">微软雅黑 (Windows)</option>
                                            <option value="SimSun">宋体 (Windows)</option>
                                            <option value="SimHei">黑体 (Windows)</option>
                                            <option value="KaiTi">楷体 (Windows)</option>
                                            <option value="FangSong">仿宋 (Windows)</option>
                                            <option value="Noto Sans CJK SC">Noto Sans CJK SC (Linux)</option>
                                            <option value="Noto Serif CJK SC">Noto Serif CJK SC (Linux)</option>
                                            <option value="PingFang SC">苹方 (macOS)</option>
                                        </select>
                                    </div>
                                    <div class="args-row">
                                        <label for="pdfMonoFont">代码字体</label>
                                        <select id="pdfMonoFont">
                                            <option value="" selected>默认 (自动选择)</option>
                                            <option value="Consolas">Consolas (Windows)</option>
                                            <option value="DejaVu Sans Mono">DejaVu Sans Mono (Linux)</option>
                                            <option value="Menlo">Menlo (macOS)</option>
                                            <option value="Source Code Pro">Source Code Pro</option>
                                            <option value="Fira Code">Fira Code</option>
                                        </select>
                                    </div>
                                    <div class="args-row">
                                        <label for="pdfFontSize">字体大小</label>
                                        <select id="pdfFontSize">
                                            <option value="">默认(11pt)</option>
                                            <option value="10pt">10pt</option>
                                            <option value="11pt">11pt</option>
                                            <option value="12pt">12pt</option>
                                        </select>
                                    </div>
                                    <div class="args-row">
                                        <label for="pdfLineStretch">行间距</label>
                                        <select id="pdfLineStretch">
                                            <option value="">默认(1.0)</option>
                                            <option value="1.0">1.0</option>
                                            <option value="1.15">1.15</option>
                                            <option value="1.25">1.25</option>
                                            <option value="1.5">1.5</option>
                                            <option value="2.0">2.0</option>
                                        </select>
                                    </div>
                                </div>
                                <!-- 封面设置 -->
                                <div class="args-category">
                                    <h4>封面设置</h4>
                                    <label class="checkbox-label">
                                        <input type="checkbox" id="pdfTitlePage" checked> 启用封面
                                    </label>
                                    <div class="args-row">
                                        <label for="pdfTitleBgColor">封面背景色</label>
                                        <input type="color" id="pdfTitleBgColor" value="#2C3E50">
                                    </div>
                                    <div class="args-row">
                                        <label for="pdfTitleTextColor">封面文字色</label>
                                        <input type="color" id="pdfTitleTextColor" value="#FFFFFF">
                                    </div>
                                    <div class="args-row">
                                        <label for="pdfTitleRuleColor">装饰线颜色</label>
                                        <input type="color" id="pdfTitleRuleColor" value="#3498DB">
                                    </div>
                                </div>
                                <!-- 页面设置 -->
                                <div class="args-category">
                                    <h4>页面设置</h4>
                                    <div class="args-row">
                                        <label for="pdfGeometry">页边距</label>
                                        <select id="pdfGeometry">
                                            <option value="">默认</option>
                                            <option value="margin=2cm">2cm</option>
                                            <option value="margin=2.5cm" selected>2.5cm</option>
                                            <option value="margin=3cm">3cm</option>
                                            <option value="margin=1in">1英寸</option>
                                        </select>
                                    </div>
                                    <div class="args-row">
                                        <label for="pdfPaperSize">纸张大小</label>
                                        <select id="pdfPaperSize">
                                            <option value="">默认(A4)</option>
                                            <option value="a4paper">A4</option>
                                            <option value="letterpaper">Letter</option>
                                            <option value="a5paper">A5</option>
                                        </select>
                                    </div>
                                    <label class="checkbox-label">
                                        <input type="checkbox" id="pdfTocOwnPage" checked> 目录单独一页
                                    </label>
                                </div>
                                <!-- 链接设置 -->
                                <div class="args-category">
                                    <h4>链接设置</h4>
                                    <label class="checkbox-label">
                                        <input type="checkbox" id="pdfColorLinks" checked> 彩色链接
                                    </label>
                                    <div class="args-row">
                                        <label for="pdfLinkColor">链接颜色</label>
                                        <input type="color" id="pdfLinkColor" value="#2980B9">
                                    </div>
                                    <div class="args-row">
                                        <label for="pdfUrlColor">URL颜色</label>
                                        <input type="color" id="pdfUrlColor" value="#3498DB">
                                    </div>
                                </div>
                                <!-- 代码块设置 -->
                                <div class="args-category">
                                    <h4>代码块设置</h4>
                                    <label class="checkbox-label">
                                        <input type="checkbox" id="pdfListings" checked> 使用 listings 包
                                    </label>
                                    <label class="checkbox-label">
                                        <input type="checkbox" id="pdfListingsNoBreak" checked> 代码块不跨页
                                    </label>
                                    <div class="args-row">
                                        <label for="pdfCodeFontSize">代码字体大小</label>
                                        <select id="pdfCodeFontSize">
                                            <option value="">默认</option>
                                            <option value="\\tiny">tiny</option>
                                            <option value="\\scriptsize">scriptsize</option>
                                            <option value="\\footnotesize">footnotesize</option>
                                            <option value="\\small" selected>small</option>
                                            <option value="\\normalsize">normalsize</option>
                                        </select>
                                    </div>
                                </div>
                                <!-- 页眉页脚 -->
                                <div class="args-category">
                                    <h4>页眉页脚</h4>
                                    <div class="args-row">
                                        <label for="pdfHeaderLeft">左页眉</label>
                                        <select id="pdfHeaderLeft">
                                            <option value="">无</option>
                                            <option value="\\leftmark" selected>章节名</option>
                                            <option value="\\rightmark">小节名</option>
                                        </select>
                                    </div>
                                    <div class="args-row">
                                        <label for="pdfHeaderRight">右页眉</label>
                                        <select id="pdfHeaderRight">
                                            <option value="">无</option>
                                            <option value="\\thepage" selected>页码</option>
                                            <option value="\\leftmark">章节名</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="form-group" style="margin-top: 15px;">
                        <label>文件名预览</label>
                        <div id="filenamePreview" class="filename-preview">-</div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="hideConfigModal()">取消</button>
                <button type="button" class="btn btn-primary" onclick="submitConfig()">
                    <span class="btn-text">保存配置</span>
                    <span class="btn-loading" style="display:none;">保存中...</span>
                </button>
            </div>
        </div>
    </div>

    <!-- 确认删除对话框 -->
    <div id="confirmModal" class="modal">
        <div class="modal-content modal-sm">
            <div class="modal-header">
                <h2>确认删除</h2>
                <button class="modal-close" onclick="hideConfirmModal()">&times;</button>
            </div>
            <div class="modal-body">
                <p id="confirmMessage">确定要删除此配置吗？</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="hideConfirmModal()">取消</button>
                <button type="button" class="btn btn-danger" id="confirmDeleteBtn">删除</button>
            </div>
        </div>
    </div>

    <script src="/static/app.js"></script>
</body>
</html>
