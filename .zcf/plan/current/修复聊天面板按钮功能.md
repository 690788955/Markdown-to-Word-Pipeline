# 修复聊天面板按钮功能

**创建时间**: 2026-02-12 11:09:15
**状态**: 执行中

## 任务上下文

用户报告聊天面板存在两个问题：
1. 点击活动栏的聊天按钮，聊天面板不会折叠，一直可见
2. 聊天面板内的设置按钮点击无反应

## 问题诊断

通过代码分析，确认了两个根本问题：

### 问题 1：活动栏聊天按钮未绑定事件
- **文件**: `web/static/editor/main.js:57-58`
- **现状**: 只绑定了文件树和 Git 面板按钮
- **缺失**: `toggleChatPanel` 按钮的点击事件

### 问题 2：设置按钮事件绑定存在时序问题
- **文件**: `web/static/editor/chat.js`
- **原因**: `ChatPanel` 初始化时，DOM 元素可能尚未完全加载
- **影响**: 设置按钮点击无反应

## 解决方案

采用**方案 1：最小修复**，仅修复缺失的事件绑定。

## 执行步骤

### 步骤 1：修复活动栏聊天按钮事件绑定 ⏳
**文件**: `web/static/editor/main.js`
**位置**: 第 58 行后
**操作**: 添加聊天按钮的事件绑定
```javascript
document.getElementById('toggleChatPanel').addEventListener('click', EditorApp.Layout.toggleChatPanel);
```
**预期结果**: 点击活动栏聊天按钮能正常折叠/展开聊天面板

### 步骤 2：验证设置按钮事件绑定 ⏳
**文件**: `web/static/editor/chat.js`
**位置**: `attachEventListeners` 方法
**操作**: 检查设置按钮事件绑定代码是否正确
**预期结果**: 确认代码逻辑正确

### 步骤 3：添加快捷键支持 ⏳
**文件**: `web/static/editor/main.js`
**位置**: `onKeyDown` 函数
**操作**: 添加 Ctrl+Shift+A 快捷键支持
```javascript
// Ctrl+Shift+A 切换聊天面板
if (e.ctrlKey && e.shiftKey && e.key === 'A') {
    e.preventDefault();
    EditorApp.Layout.toggleChatPanel();
}
```
**预期结果**: 按 Ctrl+Shift+A 能切换聊天面板

### 步骤 4：测试验证 ⏳
**操作**:
1. 刷新页面
2. 点击活动栏聊天按钮，验证面板折叠/展开
3. 点击设置按钮，验证配置对话框打开
4. 测试快捷键 Ctrl+Shift+A

## 文件修改清单

| 文件 | 修改类型 | 行数 | 说明 |
|------|---------|------|------|
| `web/static/editor/main.js` | 新增 | ~58 | 添加聊天按钮事件绑定 |
| `web/static/editor/main.js` | 新增 | ~140 | 添加快捷键支持 |

## 风险评估

- **风险等级**: 低
- **影响范围**: 仅聊天面板功能
- **回滚方案**: 移除新增代码即可
