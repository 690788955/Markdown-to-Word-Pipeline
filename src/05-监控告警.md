# 监控告警

## 监控体系

```
┌─────────────────────────────────────────────────┐
│                   Grafana                        │
│                  (可视化)                         │
└─────────────────────┬───────────────────────────┘
                      │
┌─────────────────────▼───────────────────────────┐
│                 Prometheus                       │
│                 (数据存储)                        │
└─────────────────────┬───────────────────────────┘
                      │
    ┌─────────────────┼─────────────────┐
    │                 │                 │
┌───▼───┐        ┌───▼───┐        ┌───▼───┐
│Node   │        │MySQL  │        │Nginx  │
│Exporter│       │Exporter│       │Exporter│
└───────┘        └───────┘        └───────┘
```

## 关键指标

### 系统指标

| 指标 | 告警阈值 | 说明 |
|------|---------|------|
| CPU使用率 | > 80% | 持续5分钟 |
| 内存使用率 | > 85% | 持续5分钟 |
| 磁盘使用率 | > 80% | - |
| 磁盘IO等待 | > 50% | 持续5分钟 |
| 网络带宽 | > 80% | 持续5分钟 |

### 应用指标

| 指标 | 告警阈值 | 说明 |
|------|---------|------|
| HTTP 5xx | > 1% | 每分钟 |
| 响应时间P99 | > 2s | 持续3分钟 |
| QPS | 环比下降50% | 持续5分钟 |
| 错误率 | > 0.1% | 持续3分钟 |

### 数据库指标

| 指标 | 告警阈值 | 说明 |
|------|---------|------|
| 连接数 | > 80% | 占最大连接数 |
| 慢查询 | > 10/min | - |
| 主从延迟 | > 10s | - |
| 死锁 | > 0 | - |

## 告警通知

### 通知渠道

| 级别 | 通知方式 |
|------|---------|
| P0 | 电话 + 短信 + 钉钉 |
| P1 | 短信 + 钉钉 |
| P2 | 钉钉 |
| P3 | 邮件 |

### 值班安排

| 时段 | 值班人员 |
|------|---------|
| 工作日 09:00-18:00 | 当日值班 |
| 工作日 18:00-09:00 | 轮值人员 |
| 周末/节假日 | 轮值人员 |

## Grafana 面板

### 常用面板

1. **系统概览** - 服务器资源使用情况
2. **应用监控** - QPS、响应时间、错误率
3. **数据库监控** - 连接数、慢查询、主从状态
4. **业务大盘** - 核心业务指标
